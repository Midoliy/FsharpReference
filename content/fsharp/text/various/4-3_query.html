<!DOCTYPE html>
<html lang="ja">

<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143164157-1"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-143164157-1');
    </script>
    


    <!-- Google Adsense -->
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5419541141241701",
            enable_page_level_ads: true
        });
    </script>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-5419541141241701"
            data-ad-slot="1814399841"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <!-- コードハイライトライブラリ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/vs.min.css">
    <script src="../../../../lib/highlight.pack.js"></script>    
    <script>hljs.initHighlightingOnLoad();</script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="google-site-verification" content="09hfklx0xyk42C60Ah0xvRFySTBGutqeAlcYIgZrI9A" />
    <meta name="keywords" content="F,F#,Ｆ＃,Ｆ,FSharp,F-Sharp,query,クエリ式,クエリ,computation,Midoliy">

    <title>Midoliy |> F# - クエリ式</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel="stylesheet" href="../../../../css/text-page.css?20190311/">

</head>

<body>
    <header>
        <div class="icon">
            <a href="../../index.html" title="F#-TOPへ">
                <div>クエリ式</div>
            </a>
            <div>Midoliy｜F#プログラミング</div>
        </div>
    </header>

    <section>
        <!-- index-column -->
        <div class="content-list">
            <div><a href="#クエリ式の概要" class="section-title"><b> クエリ式の概要</b></a></div>
            <div><a href="#クエリ演算子の概要" class="section-title"><b> クエリ演算子の概要</b></a></div>
            <div><a href="#contains" class="section-title"><b><span style="font-size:0.8em">　|> contains</span></b></a></div>
            <div><a href="#distinct" class="section-title"><b><span style="font-size:0.8em">　|> distinct</span></b></a></div>
            <div><a href="#exists" class="section-title"><b><span style="font-size:0.8em">　|> exists</span></b></a></div>
            <div><a href="#find" class="section-title"><b><span style="font-size:0.8em">　|> find</span></b></a></div>
            <div><a href="#all" class="section-title"><b><span style="font-size:0.8em">　|> all</span></b></a></div>
            <div><a href="#nth" class="section-title"><b><span style="font-size:0.8em">　|> nth</span></b></a></div>
            <div><a href="#where" class="section-title"><b><span style="font-size:0.8em">　|> where</span></b></a></div>
            <div><a href="#where" class="section-title"><b><span style="font-size:0.8em">　|> select</span></b></a></div>
            <div><a href="#count" class="section-title"><b><span style="font-size:0.8em">　|> count</span></b></a></div>
            <div><a href="#head" class="section-title"><b><span style="font-size:0.8em">　|> head</span></b></a></div>
            <div><a href="#headOrDefault" class="section-title"><b><span style="font-size:0.8em">　|> headOrDefault</span></b></a></div>
            <div><a href="#last" class="section-title"><b><span style="font-size:0.8em">　|> last</span></b></a></div>
            <div><a href="#lastOrDefault" class="section-title"><b><span style="font-size:0.8em">　|> lastOrDefault</span></b></a></div>
            <div><a href="#exactlyOne" class="section-title"><b><span style="font-size:0.8em">　|> exactlyOne</span></b></a></div>
            <div><a href="#exactlyOneOrDefault" class="section-title"><b><span style="font-size:0.8em">　|> exactlyOneOrDefault</span></b></a></div>
            <div><a href="#minBy" class="section-title"><b><span style="font-size:0.8em">　|> minBy</span></b></a></div>
            <div><a href="#minByNullable" class="section-title"><b><span style="font-size:0.8em">　|> minByNullable</span></b></a></div>
            <div><a href="#maxBy" class="section-title"><b><span style="font-size:0.8em">　|> maxBy</span></b></a></div>
            <div><a href="#maxByNullable" class="section-title"><b><span style="font-size:0.8em">　|> maxByNullable</span></b></a></div>
            <div><a href="#sumBy" class="section-title"><b><span style="font-size:0.8em">　|> sumBy</span></b></a></div>
            <div><a href="#sumByNullable" class="section-title"><b><span style="font-size:0.8em">　|> sumByNullable</span></b></a></div>
            <div><a href="#averageBy" class="section-title"><b><span style="font-size:0.8em">　|> averageBy</span></b></a></div>
            <div><a href="#averageByNullable" class="section-title"><b><span style="font-size:0.8em">　|> averageByNullable</span></b></a></div>
            <div><a href="#groupBy" class="section-title"><b><span style="font-size:0.8em">　|> groupBy</span></b></a></div>
            <div><a href="#sortBy" class="section-title"><b><span style="font-size:0.8em">　|> sortBy</span></b></a></div>
            <div><a href="#sortByDescending" class="section-title"><b><span style="font-size:0.8em">　|> sortByDescending</span></b></a></div>
            <div><a href="#sortByNullable" class="section-title"><b><span style="font-size:0.8em">　|> sortByNullable</span></b></a></div>
            <div><a href="#sortByNullableDescending" class="section-title"><b><span style="font-size:0.8em">　|> sortByNullableDescending</span></b></a></div>
            <div><a href="#skip" class="section-title"><b><span style="font-size:0.8em">　|> skip</span></b></a></div>
        </div>
        
        <!-- content-column -->
        <div class="content">

            <!-- --------------- -->
            <!--  クエリ式の概要  -->
            <!-- --------------- -->
            <h1 id="クエリ式の概要" class="section-title"> クエリ式の概要</h1>
            <div>
                <br>

                　クエリ式(= query式)はF#でLINQをサポートするために存在しているコンピュテーション式です。<br>
                　LINQというのは、SQLのような文法でデータの集合を操作するための機能のことです。C#では非常によく使われる機能の一つです。それをF#でも利用できるようにしたのが、この<span class="keyword">クエリ式</span>というわけです。<br>
                <br>

                　クエリ式は、主にデータベースの操作によく使われますが、list型やarray型に使用しても問題ありません。ただし、list型などは、それぞれに特化したListモジュールやArrayモジュールを利用するのが一般的ですので、状況に合わせて使い分けできるとよいでしょう。<br>
                <br>

                <pre class="code-font"><code class="fsharp">// [ 構文 ]
query { expression }</code></pre>
                <br>

                　構文の「<span class="keyword">expression</span>」には、クエリ式内で有効な<span class="keyword">クエリ演算子</span>などを利用した式が記述されます。<br>
                　以下は、<span class="keyword">select演算子</span>を用いた、クエリ式の簡単な例です。<br>
                <br>
                
                <div class="code"><script src="https://gist.github.com/Midoliy/4aac5c2480d1f41ed0481b483e0e7aba.js?file=query1.fs"></script></div>

                <br>
            </div>

            <br>

            <!-- ------------------- -->
            <!--  クエリ演算子の概要  -->
            <!-- ------------------- -->
            <h1 id="クエリ演算子の概要" class="section-title"> クエリ演算子の概要</h1>
            <div>
                <br>

                　クエリ演算子を利用すると、データの集合から「ある条件」に合致するデータのみを取得したり、取得したデータ群をソートしたりするなどの処理を、SQLのように簡単に記述することが可能となります。ただし、対象のデータ集合がクエリ演算子をサポートしている必要があります。サポートされていないクエリ演算子を使用すると、System.NotSupportedExceptionがthrowされます。<br>
                　クエリ式にはSQL式に変換できる式のみ使用することが可能です。たとえば、whereクエリ演算子を使用する場合には、式の中で関数呼び出しをすることはできません。このように、各クエリ演算子によって許容されているコードが違いますので、注意しましょう。<br>
                　以下にクエリ演算子の一部を紹介いたします。ここで紹介するものがすべてではありませんので、その点ご留意ください。(今後すべての演算子を紹介できるよう、時々アップデートしていきます)<br>

                <br>
            </div>

            <br>

            <!--  contains  -->
            <h1 id="contains" class="section-title"> contains</h1>
            <div>
                <br>
                　containsクエリ演算子は、選択した要素に指定の要素が含まれるかどうかを確認します。指定した要素が含まれる場合に、trueを返します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// contains クエリ演算子のサンプル

// 0 ~ 9のlist
let ls = [0..9]

query {
    for i in ls do
        contains 5
}
|> printfn "contains 5= %b"
// output:
//      contains 5= true

query {
    for i in ls do
        contains 10
}
|> printfn "contains 10= %b"
// output:
//      contains 10= false</code></pre>

                <br>
            </div>

            <br>

            <!--  distinct  -->
            <h1 id="distinct" class="section-title"> distinct</h1>
            <div>
                <br>
                　distinctクエリ演算子は、選択した要素から重複なしのシーケンスを作成します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// distinct クエリ演算子のサンプル

// 重複のあるリスト
let ls = [ 0; 0; 1; 2; 3; 3; 4; 5; 5; 5; 5; ]

query {
    for i in ls do
        distinct       // 重複なしのSeqを作成します.
}
|> Seq.toArray
|> printfn "distinct= %A"
// output:
//      distinct= [|0; 1; 2; 3; 4; 5|]

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        distinct        // 重複なしのSeqを作成します.
}
|> Seq.toArray
|> printfn "distinct= %A"
// output:
//      distinct= [|5|]</code></pre>

                <br>
            </div>

            <br>

            <!--  exists  -->
            <h1 id="exists" class="section-title"> exists</h1>
            <div>
                <br>
                　existsクエリ演算子は、選択した要素に特定の要素が存在しているかチェックします。条件に合致する特定の要素が存在している場合に、true を返します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// exists クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        exists (i &lt; 0)       // ls の中に 0未満の数値 が存在しているかチェックします.
}
|> printfn "exists (i &lt; 0)= %b"
// output:
//      exists (i &lt; 0)= false

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        exists (i = 7)  // whereで抽出した数値の中に 7 が存在しているかチェックします.
}
|> printfn "exists (i = 7)= %b"
// output:
//      exists (i = 7)= true</code></pre>

                <br>
            </div>

            <br>

            <!--  find  -->
            <h1 id="find" class="section-title"> find</h1>
            <div>
                <br>
                　findクエリ演算子は、指定された条件を満たす値を検索し、 条件を満たす最初の要素を取得してきます.<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// find クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        find (2 &lt;= i)       // lsの中から 2以上の値 を検索し, 条件を満たす先頭の要素を取得します.
}
|> printfn "find (2 &lt;= i)= %d"
// output:
//      find (2 &lt;= i)= 2

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        find (i = 7)    // whereで抽出した数値の中から 7 を検索します.
}
|> printfn "find (i = 7)= %d"
// output:
//      find (i = 7)= 7

// 条件に合致する値がない場合, System.InvalidOperationException が throw されます.
query {
    for i in ls do
        find (i &lt; 0)
}
|> printfn "find (i &lt; 0)= %d"
// output:
//      ハンドルされていない例外: System.InvalidOperationException:
//      シーケンスに、一致する要素は含まれてません</code></pre>

                <br>
            </div>

            <br>

            <!--  all  -->
            <h1 id="all" class="section-title"> all</h1>
            <div>
                <br>
                　allクエリ演算子は、これまでに抽出した値のすべての要素が条件を満たすかどうかをチェックします。 すべての要素が条件を満たす場合、true を返します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// all クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        all (2 &lt;= i)       // すべての要素が 2以上 かチェックします.
}
|> printfn "all (2 &lt;= i)= %b"
// output:
//      all (2 &lt;= i)= false

query {
    for i in ls do
        where (5 &lt;= i)              // 5以上の値を抽出します.
        all (5 &lt;= i && i &lt; 10)      // 現在選択中の要素が 5以上, 10未満 かチェックします.
}
|> printfn "all (5 &lt;= i && i &lt; 10)= %b"
// output:
//      all (5 &lt;= i && i &lt; 10)= true</code></pre>

                <br>
            </div>

            <br>

            <!--  nth  -->
            <h1 id="nth" class="section-title"> nth</h1>
            <div>
                <br>
                　nthクエリ演算子は、これまでに抽出した値の中から、指定したインデックスにある要素を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// nth クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        nth 5       // lsの中から, 指定したインデックスにある要素を取得します.
}
|> printfn "nth 5= %d"
// output:
//      nth 5= 5

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上 の値を抽出します.
        nth 2           // 現在選択中の要素の中から, 指定したインデックスにある要素を取得します.
}
|> printfn "nth 2= %d"
// output:
//      nth 2= 7

// 選択している要素がない場合, System.ArgumentOutOfRangeException が throw されます.
query {
    for i in ls do
        where (i &lt; 0)   // 0未満 の値を抽出します.
        nth 2
}
|> printfn "nth 2= %d"
// output:
//      ハンドルされていない例外: System.ArgumentOutOfRangeException: 
//      指定された引数は、有効な値の範囲内にありません。
</code></pre>

                <br>
            </div>

            <br>

            <!--  where  -->
            <h1 id="where" class="section-title"> where</h1>
            <div>
                <br>

                　whereクエリ演算子は、指定した条件に基づいて要素を抽出します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// where クエリ演算子のサンプル

// 0~9のlist
let ls = [0..9]

query {
    for i in ls do
        where (i &lt; 5)   // listの中から [5未満の値] を抽出します.
}
|> Seq.toArray
|> printfn "where (i &lt; 5)= %A"
// output:
//      where (i &lt; 5)= [|0; 1; 2; 3; 4|]

query {
    for i in ls do
        where (i = 5)   // listの中から [5] と一致する値だけを抽出します.
}
|> Seq.toArray
|> printfn "where (i = 5)= %A"
// output:
//      where (i = 5)= [|5|]

query {
    for i in ls do
        where (10 &lt; i)   // listの中から [10超過の値] を抽出します.
}
|> Seq.toArray
|> printfn "where (10 &lt; i)= %A"
// output:
//      where (10 &lt; i)= [||]</code></pre>

                <br>
            </div>

            <br>

            <!--  select  -->
            <h1 id="select" class="section-title"> select</h1>
            <div>
                <br>
                　selectクエリ演算子は、これまでに抽出した値の中にある必要な要素値を抽出することができます。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// select クエリ演算子のサンプル

[&lt;Measure&gt;]
type years

// サンプル用のrecord型
type Personal = { Name:string; Age:int&lt;years&gt;; }

let persons = [ 
    { Name="Alice"; Age=20&lt;years&gt;; }
    { Name="Bob"; Age=21&lt;years&gt;; }
    { Name="Cheryl"; Age=22&lt;years&gt;; }
    { Name="Daniel"; Age=23&lt;years&gt;; }
    { Name="Edward"; Age=24&lt;years&gt;; }
    { Name="Fernando"; Age=25&lt;years&gt;; }
]

query {
    for p in persons do
        select p.Name  // Pesonal listの各要素の中から, Name要素のみを抽出します.
}
|> Seq.toArray
|> printfn "select p.Name array= %A"
// output:
//      select p.Name array= [|"Alice"; "Bob"; "Cheryl"; "Daniel"; "Edward"; "Fernando"|]

query {
    for p in persons do
        select p.Age  // Pesonal listの各要素の中から, Age要素のみを抽出します.
}
|> Seq.toArray
|> printfn "select p.Age array= %A"
// output:
//      select p.Age array= [|20; 21; 22; 23; 24; 25|]

query {
    for p in persons do
        where (23&lt;years&gt; &lt; p.Age)    // 年齢が23歳よりも上の人物のみ抽出します
        select p.Name         // whereで抽出した人物の名前のみ抽出します
}
|> Seq.toArray
|> printfn "array= %A"
// output:
//      array= [|"Edward"; "Fernando"|]</code></pre>

                <br>
            </div>

            <br>

            <!--  count  -->
            <h1 id="count" class="section-title"> count</h1>
            <div>
                <br>

                　countクエリ演算子は、これまでに抽出した要素数を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// count クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        count       // countだけ利用すると, 全要素数を取得可能です.
}
|> printfn "count= %d"
// output:
//      count= 10

query {
    for i in ls do
        where (i &lt; 5)   // 5未満の値を抽出します.
        count           // whereで抽出した値の要素数を取得します.
}
|> printfn "count= %d"
// output:
//      count= 5</code></pre>

                <br>
            </div>

            <br>

            <!--  head  -->
            <h1 id="head" class="section-title"> head</h1>
            <div>
                <br>

                　headクエリ演算子は、これまでに抽出した要素の中から先頭の要素を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// head クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        head       // 全要素の中から先頭の要素を取得可能です.
}
|> printfn "head= %d"
// output:
//      head= 0

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        head            // whereで抽出した要素の先頭を取得します.
}
|> printfn "head= %d"
// output:
//      head= 5

query {
    for i in ls do
        where (10 &lt; i)  // 10超過の値を抽出します.
        head            // 要素がない場合, 例外が発生します.
}
|> printfn "head= %d"
// output:
//      System.InvalidOperationException: シーケンスに要素が含まれていません.</code></pre>

                <br>
            </div>

            <br>

            <!--  headOrDefault  -->
            <h1 id="headOrDefault" class="section-title"> headOrDefault</h1>
            <div>
                <br>

                　headOrDefaultクエリ演算子は、これまでに抽出した要素の中から先頭の要素を取得します。また、シーケンスに要素がない場合は、デフォルト値を返します。<br>

                <pre class="code-font"><code class="fsharp">// ------------------------------------
// headOrDefault クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        headOrDefault   // 全要素の中から先頭の要素を取得可能です.
}
|> printfn "head= %d"
// output:
//      head= 0

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        headOrDefault   // whereで抽出した要素の先頭を取得します.
}
|> printfn "head= %d"
// output:
//      head= 5

query {
    for i in ls do
        where (10 &lt; i)  // 10超過の値を抽出します.
        headOrDefault   // 要素がない場合, デフォルト値が得られます.
}
|> printfn "head= %d"
// output:
//      head= 0</code></pre>

                <br>
            </div>

            <br>

            <!--  last  -->
            <h1 id="last" class="section-title"> last</h1>
            <div>
                <br>

                　lastクエリ演算子は、これまでに抽出した要素の中から最後の要素を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// last クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        last       // 全要素の最後の要素を取得可能です.
}
|> printfn "last= %d"
// output:
//      last= 9

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        last            // whereで抽出した要素の最終要素を取得します.
}
|> printfn "last= %d"
// output:
//      last= 9

query {
    for i in ls do
        where (10 &lt; i)  // 10超過の値を抽出します.
        last            // 要素がない場合, 例外が発生します.
}
|> printfn "last= %d"
// output:
//      System.InvalidOperationException: シーケンスに要素が含まれていません.</code></pre>

                <br>
            </div>

            <br>

            <!--  lastOrDefault  -->
            <h1 id="lastOrDefault" class="section-title"> lastOrDefault</h1>
            <div>
                <br>

                　lastOrDefaultクエリ演算子は、これまでに抽出した要素の中から最後の要素を取得します。また、シーケンスに要素がない場合は、デフォルト値を返します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// lastOrDefault クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        lastOrDefault   // 全要素の最後の要素を取得可能です.
}
|> printfn "lastOrDefault= %d"
// output:
//      last= 9

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出します.
        lastOrDefault   // whereで抽出した要素の最終要素を取得します.
}
|> printfn "lastOrDefault= %d"
// output:
//      last= 9

query {
    for i in ls do
        where (10 &lt; i)  // 10超過の値を抽出します.
        lastOrDefault   // 要素がない場合, デフォルト値が得られます.
}
|> printfn "lastOrDefault= %d"
// output:
//      lastOrDefault= 0</code></pre>

                <br>
            </div>

            <br>

            <!--  exactlyOne  -->
            <h1 id="exactlyOne" class="section-title"> exactlyOne</h1>
            <div>
                <br>

                　exactlyOneクエリ演算子は、選択されている要素が単一の場合にその要素を取得します。選択されている要素が複数存在するか、まったく存在しない場合には例外をthrowします。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------
// exactlyOne クエリ演算子のサンプル

[&lt;Measure&gt;] type old
type Person = { Name: string; Age: int&lt;old&gt;; }

let ls = [ { Name="alex"; Age=20&lt;old&gt;; }
           { Name="bob"; Age=21&lt;old&gt;; }
           { Name="carol"; Age=22&lt;old&gt;; }
           { Name="daniel"; Age=23&lt;old&gt;; } ]

query {
    for p in ls do
        where (p.Age = 21&lt;old&gt;)   // 21歳のPersonのみ抽出.
        exactlyOne                // 現在選択している要素が一つのみの場合に, 値を返します.
}
|> printfn "exactlyOne= %A"
// output:
//      exactlyOne= {Name = "bob"; Age = 21;}

query {
    for p in ls do
        where (p.Age &lt; 20&lt;old&gt;)    // 20歳未満のPersonを抽出
        exactlyOne                 // 現在選択している要素が一つもない場合, 例外が発生します.
}
|> printfn "exactlyOne= %A"
// output:
//      ハンドルされていない例外: System.InvalidOperationException:
//      シーケンスに要素が含まれていません

query {
    for i in ls do
        exactlyOne              // 要素が複数ある場合, 例外が発生します.
}
|> printfn "exactlyOne= %A"
// output:
//      ハンドルされていない例外: System.InvalidOperationException: 
//      シーケンスに複数の要素が含まれています</code></pre>

                <br>
            </div>

            <br>

            <!--  exactlyOneOrDefault  -->
            <h1 id="exactlyOneOrDefault" class="section-title"> exactlyOneOrDefault</h1>
            <div>
                <br>

                　exactlyOneクエリ演算子は、選択されている要素が単一の場合にその要素を取得します。選択している要素がまったく存在しない場合にはデフォルト値を返し、選択されている要素が複数存在する場合には例外をthrowします。<br>

                <pre class="code-font"><code class="fsharp">// ------------------------------------------
// exactlyOneOrDefault クエリ演算子のサンプル

[&lt;Measure&gt;] type old
type Person = { Name: string; Age: int&lt;old&gt;; }

let ls = [ { Name="alex"; Age=20&lt;old&gt;; }
           { Name="bob"; Age=21&lt;old&gt;; }
           { Name="carol"; Age=22&lt;old&gt;; }
           { Name="daniel"; Age=23&lt;old&gt;; } ]

query {
    for p in ls do
        where (p.Age = 21&lt;old&gt;)     // 21歳のPersonのみ抽出.
        exactlyOneOrDefault         // 現在選択している要素が一つのみの場合に, 値を返します.
}
|> printfn "exactlyOneOrDefault= %A"
// output:
//      exactlyOne= {Name = "bob"; Age = 21;}

query {
    for p in ls do
        where (p.Age &lt; 20&lt;old&gt;)     // 20歳未満のPersonを抽出
        exactlyOneOrDefault         // 現在選択している要素が一つもない場合, デフォルト値を返します.
}
|> printfn "exactlyOneOrDefault= %A"
// output:
//      exactlyOneOrDefault= &lt;null&gt;

query {
    for i in ls do
        exactlyOneOrDefault         // 要素が複数ある場合, 例外が発生します.
}
|> printfn "exactlyOneOrDefault= %A"
// output:
//      ハンドルされていない例外: System.InvalidOperationException: 
//      シーケンスに複数の要素が含まれています</code></pre>

                <br>
            </div>

            <br>

            <!--  minBy  -->
            <h1 id="minBy" class="section-title"> minBy</h1>
            <div>
                <br>

                　minByクエリ演算子は、選択されている要素の中から最小の値を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// minBy クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        minBy i
}
|> printfn "minBy= %d"
// output:
//      minBy= 0

query {
    for i in ls do
        where (5 &lt;= i)   // 5以上の値を抽出
        minBy i
}
|> printfn "minBy= %d"
// output:
//      minBy= 5

query {
    for i in ls do
        where (i &lt; 0)   // 0未満の値を抽出
        minBy i         // 現在選択している要素が一つもない場合, 例外が発生します.
}
|> printfn "minBy= %d"
// output:
//      ハンドルされていない例外: System.InvalidOperationException:
//      シーケンスに要素が含まれていません</code></pre>

                <br>
            </div>

            <br>

            <!--  minByNullable  -->
            <h1 id="minByNullable" class="section-title"> minByNullable</h1>
            <div>
                <br>

                　minByNullableクエリ演算子は、Null許容型の要素に対して利用することができ、選択されている要素の中から最小の値を取得します。その際nullは無視されます。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// minByNullable クエリ演算子のサンプル
open System

let ls = [ Nullable(1)
           Nullable()
           Nullable(2)
           Nullable(4)
           Nullable()
           Nullable(9)
           Nullable(12) ]

query {
    for i in ls do
        minByNullable i
}
|> printfn "minByNullable= %A"
// output:
//      minByNullable= 1

query {
    for i in ls do
        where (if i.HasValue then 3 &lt;= i.Value else false)   // 3以上の値を抽出
        minByNullable i
}
|> printfn "minByNullable= %A"
// output:
//      minByNullable= 4

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0 else false)   // 0未満の値を抽出
        minByNullable i
}
|> printfn "minByNullable= %A"
// output:
//      minByNullable= &lt;null&gt;</code></pre>

                <br>
            </div>

            <br>

            <!--  maxBy  -->
            <h1 id="maxBy" class="section-title"> maxBy</h1>
            <div>
                <br>

                　maxByクエリ演算子は、選択されている要素の中から最大の値を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// maxBy クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do
        maxBy i         // 最大値を取得
}
|> printfn "maxBy= %A"
// output:
//      maxBy= 9

query {
    for i in ls do
        where (3 &lt;= i && i &lt; 8)   // 3以上 かつ 8未満 の値を抽出
        maxBy i                   // 現在抽出している要素の中で最大の値を取得
}
|> printfn "maxBy= %A"
// output:
//      maxBy= 7

query {
    for i in ls do
        where (i &lt; 0)       // 0未満の値を抽出
        maxBy i             // 要素数が0の場合は, 例外が発生します
}
|> printfn "maxBy= %A"
// output:
//      ハンドルされていない例外: System.InvalidOperationException:
//      シーケンスに要素が含まれていません
</code></pre>

                <br>
            </div>

            <br>

            <!--  maxByNullable  -->
            <h1 id="maxByNullable" class="section-title"> maxByNullable</h1>
            <div>
                <br>

                　maxByNullableクエリ演算子は、Null許容型の要素に対して利用することができ、選択されている要素の中から最大の値を取得します。その際nullは無視されます。<br><br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// maxByNullable クエリ演算子のサンプル
open System

let ls = [ Nullable(1)
           Nullable()
           Nullable(2)
           Nullable(4)
           Nullable()
           Nullable(9)
           Nullable(12) ]

query {
    for i in ls do
        maxByNullable i
}
|> printfn "maxByNullable= %A"
// output:
//      maxByNullable= 12

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 10  else false)   // 10未満の値を抽出
        maxByNullable i
}
|> printfn "maxByNullable= %A"
// output:
//      maxByNullable= 9

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0 else false)   // 0未満の値を抽出
        maxByNullable i
}
|> printfn "maxByNullable= %A"
// output:
//      maxByNullable= &lt;null&gt;</code></pre>

                <br>
            </div>

            <br>

            <!--  sumBy  -->
            <h1 id="sumBy" class="section-title"> sumBy</h1>
            <div>
                <br>

                　sumByクエリ演算子は、選択されている要素の合計値を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sumBy クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do 
        sumBy i
}
|> printfn "sumBy= %d"
// output:
//      sumBy= 45

query {
    for i in ls do
        where (5 &lt;= i)  // 5以上の値を抽出
        sumBy i         // 抽出した値を合計
}
|> printfn "sumBy= %d"
// output:
//      sumBy= 35

query {
    for i in ls do
        where (i &lt; 0)   // 0未満の値を抽出
        sumBy i         // 対象要素が0の場合, 0を返します
}
|> printfn "sumBy= %d"
// output:
//      sumBy= 0</code></pre>

                <br>
            </div>

            <br>

            <!--  sumByNullable  -->
            <h1 id="sumByNullable" class="section-title"> sumByNullable</h1>
            <div>
                <br>

                　sumByNullableクエリ演算子は、Null許容型の要素に対して利用することができ、選択されている要素の合計値を取得します。その際nullは無視されます。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sumByNullable クエリ演算子のサンプル
open System

let ls = [ Nullable(1)
           Nullable()
           Nullable(2)
           Nullable(4)
           Nullable()
           Nullable(9)
           Nullable(12) ]

query {
    for i in ls do
        sumByNullable i
}
|> printfn "sumByNullable= %A"
// output:
//      sumByNullable= 28

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 10  else false)   // 10未満の値を抽出
        sumByNullable i
}
|> printfn "sumByNullable= %A"
// output:
//      sumByNullable= 16

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0 else false)   // 0未満の値を抽出
        sumByNullable i
}
|> printfn "sumByNullable= %A"
// output:
//      sumByNullable= 0</code></pre>

                <br>
            </div>

            <br>

            <!--  averageBy  -->
            <h1 id="averageBy" class="section-title"> averageBy</h1>
            <div>
                <br>

                　averageByクエリ演算子は、選択されている要素の平均値を取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// averageBy クエリ演算子のサンプル

let ls = [ 0..9 ]

query {
    for i in ls do 
        averageBy (float i)
}
|> printfn "averageBy= %f"
// output:
//      averageBy= 4.500000

query {
    for i in ls do
        where (5 &lt;= i)          // 5以上の値を抽出
        averageBy (float i)     // 抽出した値を合計
}
|> printfn "averageBy= %f"
// output:
//      averageBy= 7.000000

query {
    for i in ls do
        where (i &lt; 0)           // 0未満の値を抽出
        averageBy (float i)     // 対象要素が0の場合, 例外が発生します
}
|> printfn "averageBy= %f"
// output:
//      ハンドルされていない例外: System.InvalidOperationException: source</code></pre>

                <br>
            </div>

            <br>

            <!--  averageByNullable  -->
            <h1 id="averageByNullable" class="section-title"> averageByNullable</h1>
            <div>
                <br>

                　averageByNullableクエリ演算子は、Null許容型の要素に対して利用することができ、選択されている要素の平均値を取得します。その際nullは無視されます。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// averageByNullable クエリ演算子のサンプル
open System

let ls = [ Nullable(1.)
           Nullable()
           Nullable(2.)
           Nullable(4.)
           Nullable()
           Nullable(9.)
           Nullable(12.) ]

query {
    for i in ls do
        averageByNullable i
}
|> printfn "averageByNullable= %A"
// output:
//      averageByNullable= 4.0

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 10.  else false)   // 10未満の値を抽出
        averageByNullable i
}
|> printfn "averageByNullable= %A"
// output:
//      averageByNullable= 4.0

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0. else false)   // 0未満の値を抽出
        averageByNullable i
}
|> printfn "averageByNullable= %A"
// output:
//      averageByNullable= <null></code></pre>

                <br>
            </div>

            <br>

            <!--  groupBy  -->
            <h1 id="groupBy" class="section-title"> groupBy</h1>
            <div>
                <br>

                　groupByクエリ演算子は、選択されている要素を、指定したキーセレクターに従ってグループ化します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// groupBy クエリ演算子のサンプル

type Person = { ID: string; Name: string; Age: int; }

let persons = [ { ID="0x00"; Name="Alice";  Age=22}
                { ID="0x00"; Name="Bob";    Age=23}
                { ID="0x01"; Name="Chris";  Age=32}
                { ID="0x01"; Name="Edward"; Age=45}
                { ID="0x02"; Name="Felix";  Age=26} ]

query {
    for p in persons do 
        groupBy p.ID into g     // Person.IDでグループ化
        select g
}
|> printfn "groupBy= %A"
// output:  ID毎にグループ化されていることがわかります.
//      groupBy= [seq [{ID = "0x00";
//                      Name = "Alice";
//                      Age = 22;};
//                     {ID = "0x00";
//                      Name = "Bob";
//                      Age = 23;}]; 
//                seq [{ID = "0x01";
//                      Name = "Chris";
//                      Age = 32;};
//                     {ID = "0x01";
//                      Name = "Edward";
//                      Age = 45;}];
//                seq [{ID = "0x02";
//                      Name = "Felix";
//                      Age = 26;}]]

query {
    for p in persons do
        groupBy p.ID into g     // Person.IDでグループ化
        select g.Key            // Keyとなった値のみを抽出
}
|> printfn "groupBy= %A"
// output:  Key値が重複なしで取得可能です.
//      groupBy= seq ["0x00"; "0x01"; "0x02"]
</code></pre>

                <br>
            </div>

            <br>

            <!--  sortBy  -->
            <h1 id="sortBy" class="section-title"> sortBy</h1>
            <div>
                <br>

                　sortByクエリ演算子は、選択されている要素を、昇り順にソートしたシーケンスを取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sortBy クエリ演算子のサンプル

let ls = [ 5; 9; 6; 3; 2; 0; 4; 1; 7; 8; ]

query {
    for l in ls do
        sortBy l    // 昇り順にソート
}
|> Seq.toList
|> printfn "sortBy= %A"
// output:
//      sortBy= [0; 1; 2; 3; 4; 5; 6; 7; 8; 9]

// 元のリストには影響がないことが確認できます.
ls |> printfn "sortBy= %A"
// output:
//      sortBy= [5; 9; 6; 3; 2; 0; 4; 1; 7; 8]

query {
    for l in ls do
        where (l &lt; 6)   // 6未満の値を抽出
        sortBy l        // 昇り順にソート
}
|> Seq.toList
|> printfn "sortBy= %A"
// output:
//      sortBy= [0; 1; 2; 3; 4; 5]

query {
    for l in ls do
        where (l &lt; 0)   // 0未満の値を抽出
        sortBy l
}
|> Seq.toList
|> printfn "sortBy= %A"
// output:
//      sortBy= []</code></pre>

                <br>
            </div>

            <br>

            <!--  sortByDescending  -->
            <h1 id="sortByDescending" class="section-title"> sortByDescending</h1>
            <div>
                <br>

                　sortByDescendingクエリ演算子は、選択されている要素を、降り順にソートしたシーケンスを取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sortByDescending クエリ演算子のサンプル

let ls = [ 5; 9; 6; 3; 2; 0; 4; 1; 7; 8; ]

query {
    for l in ls do
        sortByDescending l    // 降り順にソート
}
|> Seq.toList
|> printfn "sortByDescending= %A"
// output:
//      sortByDescending= [9; 8; 7; 6; 5; 4; 3; 2; 1; 0]

// 元のリストには影響がないことが確認できます.
ls |> printfn "sortByDescending= %A"
// output:
//      sortByDescending= [5; 9; 6; 3; 2; 0; 4; 1; 7; 8]

query {
    for l in ls do
        where (l &lt; 6)           // 6未満の値を抽出
        sortByDescending l      // 降り順にソート
}
|> Seq.toList
|> printfn "sortByDescending= %A"
// output:
//      sortByDescending= [5; 4; 3; 2; 1; 0]

query {
    for l in ls do
        where (l &lt; 0)           // 0未満の値を抽出
        sortByDescending l
}
|> Seq.toList
|> printfn "sortByDescending= %A"
// output:
//      sortByDescending= []</code></pre>

                <br>
            </div>

            <br>

            <!--  sortByNullable  -->
            <h1 id="sortByNullable" class="section-title"> sortByNullable</h1>
            <div>
                <br>

                　sortByNullableクエリ演算子は、選択されているnull許容の要素を、昇り順にソートしたシーケンスを取得します。その際nullは無視されません。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sortByNullable クエリ演算子のサンプル
open System

let ls = [ Nullable(10.)
           Nullable()
           Nullable(0.)
           Nullable(6.)
           Nullable(4.)
           Nullable()
           Nullable(1.)
           Nullable(12.) ]

query {
    for i in ls do
        sortByNullable i
}
|> Seq.toList
|> printfn "sortByNullable= %A"
// output:
//      sortByNullable= [null; null; 0.0; 1.0; 4.0; 6.0; 10.0; 12.0]

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 10.  else false)   // 10未満の値を抽出
        sortByNullable i
}
|> Seq.toList
|> printfn "sortByNullable= %A"
// output:
//      sortByNullable= [0.0; 1.0; 4.0; 6.0]

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0. else false)   // 0未満の値を抽出
        sortByNullable i
}
|> Seq.toList
|> printfn "sortByNullable= %A"
// output:
//      sortByNullable= []</code></pre>

                <br>
            </div>

            <br>

            <!--  sortByNullableDescending  -->
            <h1 id="sortByNullableDescending" class="section-title"> sortByNullableDescending</h1>
            <div>
                <br>

                　sortByNullableDescendingクエリ演算子は、選択されているnull許容の要素を、降り順にソートしたシーケンスを取得します。その際nullは無視されません。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// sortByNullableDescending クエリ演算子のサンプル
open System

let ls = [ Nullable(10.)
           Nullable()
           Nullable(0.)
           Nullable(6.)
           Nullable(4.)
           Nullable()
           Nullable(1.)
           Nullable(12.) ]

query {
    for i in ls do
        sortByNullableDescending i
}
|> Seq.toList
|> printfn "sortByNullableDescending= %A"
// output:
//      sortByNullableDescending= [12.0; 10.0; 6.0; 4.0; 1.0; 0.0; null; null]

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 10.  else false)   // 10未満の値を抽出
        sortByNullableDescending i
}
|> Seq.toList
|> printfn "sortByNullableDescending= %A"
// output:
//      sortByNullableDescending= [6.0; 4.0; 1.0; 0.0]

query {
    for i in ls do
        where (if i.HasValue then i.Value &lt; 0. else false)   // 0未満の値を抽出
        sortByNullableDescending i
}
|> Seq.toList
|> printfn "sortByNullableDescending= %A"
// output:
//      sortByNullableDescending= []</code></pre>

                <br>
            </div>

            <br>

            <!--  skip  -->
            <h1 id="skip" class="section-title"> skip</h1>
            <div>
                <br>

                　skipクエリ演算子は、選択されている要素の先頭要素から指定した数分スキップしたシーケンスを取得します。<br>

                <pre class="code-font"><code class="fsharp">// -------------------------------------
// skip クエリ演算子のサンプル

let ls = [ 5; 9; 6; 3; 2; 0; 4; 1; 7; 8; ]

query {
    for l in ls do
        skip 3    // 先頭要素から3要素分スキップ
}
|> Seq.toList
|> printfn "skip 3= %A"
// output:
//      skip 3= [3; 2; 0; 4; 1; 7; 8]

query {
    for l in ls do
        sortBy l    // 昇順にソート
        skip 5      // 先頭要素から5要素分スキップ
}
|> Seq.toList
|> printfn "sortBy l >> skip 5= %A"
// output:
//      sortBy l >> skip 5= [5; 6; 7; 8; 9]

query {
    for l in ls do
        where (l &lt; 0)  // 0未満の値を抽出
        skip 3         // 対象要素が0の場合でも, 例外は発生しない
}
|> Seq.toList
|> printfn "where (l &lt; 0) >> skip 3= %A"
// output:
//      where (l &lt; 0) >> skip 3= []</code></pre>

                <br>
            </div>

            <br>

            <br>
        </div>
    </section>

    <footer>
        投稿日 : 2019/04/09
    </footer>
</body>

</html>